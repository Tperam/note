# MyCat



### 安装

- 依赖java 环境，需要安装 JDK

#### conf 目录下

| 文件       | 作用                                       | 修改内容                                 |
| ---------- | ------------------------------------------ | ---------------------------------------- |
| rule.xml   | 切分算法                                   | 修改mod-long 分片数量                    |
| server.xml | 虚拟MySQL                                  | 修改用户名、密码、逻辑库                 |
| schema.xml | 数据库连接、读写分离、负载均衡、数据表映射 | 定义连接、读写分离、负载均衡、数据表映射 |

MyCat 支持将配置文件设置到 ZooKeeper 中

-----

##### schema.xml

**schema** 标签属性

定义虚拟的逻辑库



**table** 标签属性

定义虚拟的逻辑表

- `dataNode` 真实数据存放点
- `rule` 数据拆分规则



**childTable** 标签属性

- name 表名
- primaryKey 主键
- joinKey 关联键
- parentKey 父键

-----

**dataNode** 标签属性

这是一个分片的链接节点信息

- name 名称
- dataHost 链接信息
- database 使用数据库

-----

**dataHost** 标签属性

一个分片的链接信息

- name 配置名称
- balance
  - `0` 不开启读写分离
  - `1 `保留一个写节点，只负责写入，其他节点处理读请求
  - `2 `所有写节点都要额外承担读请求（当写入操作不多时，空闲的写节点是比较浪费的）
  - `3 `写节点只处理写请求，读节点只处理读请求
- writeType
  - `0`  所有写操作都分发给第一个写节点，该节点宕机时才会启用第二个写节点
  - `1` 所有的写操作都由所有的写节点去承担
- switchType 
  - `1` 由MyCat的心跳检测来判断哪个节点宕机了，应该切换到哪一个节点上
  - `2` 用数据库集群的状态信息来判断，哪一个节点宕机了



**WriteHost** 标签属性

- `url`  数据库的ip端口
- `user` 登录数据库的用户名
- `password` 登录数据库的密码

-----

## MyCat 原理

### 数据切分

#### 主键求模切分

- 适用于在初始数据很大，但是数据增长不快的场景
  - 地图产品
  - 行政数据
  - 企业数据

#### 枚举值切分

- 按照某个字段的值（数字）来切分数据
  - 去 `conf/rule.xml`中修改 `<tableRule name="sharding-by-intfile">...</tableRule>`
    - 其中`columns`标签用于指定拆分数据的列、`algorithm`用于指定拆分的算法